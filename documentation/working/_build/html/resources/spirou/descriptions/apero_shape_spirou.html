


<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Nightly shape calibration &#8212; APERO 0.8.001 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bizstyle.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/images/fonta/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/apero.css" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
    <link rel="stylesheet" href="_static/images/fonta/css/font-awesome.min.css">



    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
    <style>
      table.right { float: left; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>
    <script>
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

  </head><body>
<div class="pageheader">

  <ul>
    <li><a title="Home" href="http://apero.exoplanets.ca/">
        <i class="fa fa-home fa-3x" aria-hidden="true"></i></a></li>
    <li><a title="install" href="http://apero.exoplanets.ca/main/general/installation.html">
        <i class="fa fa-cog fa-3x" aria-hidden="true"></i></a></li>
    <li><a title="github" href="https://github.com/njcuk9999/apero-drs">
        <i class="fa fa-git-square fa-3x" aria-hidden="true"></i></a></li>
    <li><a title="download documentation" href="http://apero.exoplanets.ca/apero-docs.pdf">
        <i class="fa fa-download fa-3x" aria-hidden="true"></i></a></li>
    <li><a title="download paper" href="https://ui.adsabs.harvard.edu/abs/2022PASP..134k4509C">
        <i class="fa fa-file-pdf-o fa-3x" aria-hidden="true"></i></a></li>
    <li><a title="UdeM" href="http://apero.exoplanets.ca/main/misc/udem.html">
        <i class="fa fa-university fa-3x" aria-hidden="true"></i></a></li>
    <li><a title="ARI" href="http://apero.exoplanets.ca/ari/home/">
        <i class="fa fa-database fa-3x" aria-hidden="true"></i></a></li>
  </ul>
    <div>
    <a href="http://apero.exoplanets.ca/">
      <img src="http://apero.exoplanets.ca/_static/images/apero_logo.png" alt="APERO" />
    </a>
    <br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A PipelinE to Reduce Observations
    </div>

</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">APERO 0.8.001 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Nightly shape calibration</a></li> 
      </ul>
    </div>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="nightly-shape-calibration">
<h1>Nightly shape calibration<a class="headerlink" href="#nightly-shape-calibration" title="Permalink to this heading">¶</a></h1>
<p>Before extracting the spectrum, we need to transform the image into a format that is amenable to a simple
1-dimensional collapse. Given our reference FP grid and the x and y displacements maps, on a given night, we only
need to find the affine transform that registers FP peaks onto the reference FP image and updates the x and y
transform maps within the affine contribution. This assumes that the order curvature is constant through the life
of the instrument and that the slicer shape is stable. We note that as the order profiles are determined in each
nightly calibration, a slight (sub-pixel) modification of the position of orders would have no impact on the
extracted spectra which are extracted with the profile measured for the corresponding night.</p>
<p>The nightly shape recipe takes preprocessed <cite>FP_FP</cite> files (as many as given by the user or as many as occur on each
of the nights being used via <cite>apero_processing</cite>). It combines the <cite>FP_FP</cite> files into a single <cite>FP_FP</cite> per night
(via a median combination of the images). After combining, the <cite>FP_FP</cite> images are calibrated using our standard
image calibration technique. We take the <cite>REFFP</cite>, <cite>SHAPEX</cite> and <cite>SHAPEY</cite> calibrations from the calibration database.
If multiple exist we use the closest in time (using the header key <cite>MIDEXPOSURE</cite> from the header).
To find the linear transform parameters (dx, dy, A, B, C, and D) between the reference <cite>FP_FP</cite> and this night’s
<cite>FP_FP</cite> we find all the FP peaks in the reference <cite>FP_FP</cite> image and in the nightly <cite>FP_FP</cite> image. Once we have the
linear transform parameters we shift and transform the combined and calibrated nightly <cite>FP_FP</cite> via our shape
transform algorithm and save the transformed image and un-transformed image to disk (for manual comparison to the
input <cite>FP_FP</cite> image).</p>
<p>As part of quality control, we check that the RMS of the residuals in both directions (across order and along the
order) are less than 0.1 pixel, which has been found to be optimal to flag pathological cases. The transformation
parameters (dx, dy, A, B, C, and D, henceforth <cite>SHAPELOCAL</cite>) are then saved to the calibration database (if both
quality control criteria are met) for use throughout APERO.</p>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">APERO 0.8.001 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Nightly shape calibration</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2024, Neil Cook.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.0.1.
    </div>
  </body>
</html>