


<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>apero_shape_ref_spirou &#8212; APERO 0.8.001 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bizstyle.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/apero.css" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="apero_shape_spirou" href="rdefinition_SHAPE.html" />
    <link rel="prev" title="apero_loc_spirou" href="rdefinition_LOC.html" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
    <link rel="stylesheet" href="_static/images/fonta/css/font-awesome.min.css">



    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
    <style>
      table.right { float: left; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>
    <script>
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

  </head><body>
<div class="pageheader">

  <ul>
    <li><a title="Home" href="../../../index.html">
        <i class="fa fa-home fa-3x" aria-hidden="true"></i></a></li>
    <li><a title="install" href="../../../user/general/installation.html">
        <i class="fa fa-cog fa-3x" aria-hidden="true"></i></a></li>
    <li><a title="github" href="https://github.com/njcuk9999/apero-drs">
        <i class="fa fa-git-square fa-3x" aria-hidden="true"></i></a></li>
    <li><a title="download documentation" href="../../../apero-docs.pdf">
        <i class="fa fa-download fa-3x" aria-hidden="true"></i></a></li>
    <li><a title="download paper" href="https://ui.adsabs.harvard.edu/abs/2022PASP..134k4509C">
        <i class="fa fa-file-pdf-o fa-3x" aria-hidden="true"></i></a></li>
    <li><a title="UdeM" href="http://apero.exoplanets.ca/main/misc/udem.html">
        <i class="fa fa-university fa-3x" aria-hidden="true"></i></a></li>
  </ul>
    <div>
    <a href="../../../index.html">
      <img src="../../../_static/images/apero_logo.png" alt="APERO" />
    </a>
    <br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A PipelinE to Reduce Observations
    </div>

</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="rdefinition_SHAPE.html" title="apero_shape_spirou"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="rdefinition_LOC.html" title="apero_loc_spirou"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">APERO 0.8.001 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../main/spirou/main_spirou.html" >SPIRou documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="recipes.html" accesskey="U">Recipes (SPIROU)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">apero_shape_ref_spirou</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">apero_shape_ref_spirou</a><ul>
<li><a class="reference internal" href="#description">1. Description</a><ul>
<li><a class="reference internal" href="#shape-reference-calibration">Shape reference calibration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#schematic">2. Schematic</a></li>
<li><a class="reference internal" href="#usage">3. Usage</a></li>
<li><a class="reference internal" href="#optional-arguments">4. Optional Arguments</a></li>
<li><a class="reference internal" href="#special-arguments">5. Special Arguments</a></li>
<li><a class="reference internal" href="#output-directory">6. Output directory</a></li>
<li><a class="reference internal" href="#output-files">7. Output files</a></li>
<li><a class="reference internal" href="#debug-plots">8. Debug plots</a></li>
<li><a class="reference internal" href="#summary-plots">9. Summary plots</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="rdefinition_LOC.html"
                          title="previous chapter">apero_loc_spirou</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="rdefinition_SHAPE.html"
                          title="next chapter">apero_shape_spirou</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/auto/recipe_definitions/spirou/rdefinition_SHAPEREF.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="apero-shape-ref-spirou">
<span id="recipes-spirou-shaperef"></span><h1>apero_shape_ref_spirou<a class="headerlink" href="#apero-shape-ref-spirou" title="Permalink to this heading">¶</a></h1>
<section id="description">
<h2>1. Description<a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>SHORTNAME: SHAPEREF</p>
<section id="shape-reference-calibration">
<h3>Shape reference calibration<a class="headerlink" href="#shape-reference-calibration" title="Permalink to this heading">¶</a></h3>
<p>In PRV measurements, constraining the exact position of orders on the science array, both in the spectral and
spatial dimensions, is key as the position of our spectra on this science array encodes the sought-after velocity of
the star. The diffraction orders of SPIRou, and nearly all PRV spectrographs, follow curved lines, and the image
slicer has a 4-point structure that is not parallel to the pixel grid.</p>
<p>Within the APERO framework, we decided to split the problem into two parts: a reference shape calibration and a
nightly shape calibration. For the reference step, we constrain the bulk motion, as defined through an affine
transformation and register all frames to a common pixel grid to well below the equivalent of 1 <span class="math notranslate nohighlight">\(ms^{-1}\)</span>.
We perform the order localization and subsequent steps on a nightly basis as it has the significant advantage that
registered frames have all orders at the same position to a very small fraction of a pixel. Furthermore, having
registered frames allows for better error handling within APERO; one does not expect pixel-level motions between
calibrations after this step.</p>
<p>The reference shape recipe takes preprocessed <cite>FP_FP</cite> and <cite>HC_HC</cite> files (as many as given by the user or as many as
occur on the nights being used via <cite>apero_processing</cite>). The reference shape recipe combines the <cite>FP_FP</cite> files into a
single <cite>FP_FP</cite> file and the <cite>HC_HC</cite> files into a single <cite>HC_HC</cite> file (via a median combination of the images).
After combining, the <cite>FP_FP</cite> and <cite>HC_HC</cite> images are calibrated using our standard image calibration technique.
In addition to the combined <cite>FP_FP</cite> and <cite>HC_HC</cite>, we create a reference FP image. This reference FP image is created
by selecting a subset of 100 <cite>FP_FP</cite> files (uniformly distributed across nights) and combining these with a median.
This reference FP image is then saved to the calibration database for use throughout APERO.</p>
<p>The registration through affine transformations is done using the`FP_FP` calibrations. We take the combined <cite>FP_FP</cite>
files and localize in the 2D frame the position of each FP peak and measure the position of the peak maxima.
Considering the 3 SPIRou fibers and 4 slices (i.e., 12 2D peaks per FP line), this means there are &gt;100000 peaks on
the science array. These are taken as reference positions. For each calibration sequence, we then find the affine
transformation that minimizes the RMS between the position of the FP and the FP reference image calibration.
The resulting affine transformation consists of a bulk shift in dx, dy, and a <span class="math notranslate nohighlight">\(2\times2\)</span> matrix that encodes
rotation, scale, and shear. These values are kept and can be useful to identify shifts in the optics (e.g., after
earthquakes or thermal cycles) as well as very slight changes in plate scale and angular position of the array which
can be of interest in understanding the impact of engineering work onto the science data products.
For example, we can readily measure a <span class="math notranslate nohighlight">\(10^{-5}\)</span> fractional change in the SPIRou plate scale following a
maintenance thermal cycle of the instrument; the ratio of the point-to-point RMS to the median of the plate scale
value is at the <span class="math notranslate nohighlight">\(1.7\times10^{-7}\)</span> level. The interpolations between pixel grids are done with a 3rd
order spline.  We note that changes in the FP cavity length arise from a number of reasons such as gas leakage and
temperature and will lead to a motion of FP peaks on the array that is not due to a physical motion of the array or
optical elements within the cryostat. Considering that typical drifts are at the <span class="math notranslate nohighlight">\(\sim0.3\)</span>,m/s/day level,
to first order this leads to a typical <span class="math notranslate nohighlight">\(10^{-9}\)</span>/day fractional increase in the plate scale along the dispersion
direction. This effectively leads to a minute change in the effective dispersion of the extracted file wavelength
solution. As this change is common to both the FP, the HC, and the science data, it is accounted for when computing
the wavelength solution and cavity length change.</p>
<p>Once the affine transformation has been applied, images are registered to a common grid (the reference FP image).
We then construct a transform that makes the orders straight and corrects for slicer structure in the dispersion
direction. This leads to the construction of two maps corresponding to x and y offsets that need to be applied to an
image to transform it into a rectified image from which a trace extraction can be performed directly through a 1-D
collapse in the direction perpendicular to the dispersion of a rectangular box around the order. The y direction map
is computed from the order-localization polynomials. The x direction map is determined by first collapsing the
straightened orders of a <cite>FP_FP</cite> calibration and cross-correlating each of the spectral direction pixel rows to find
its offset relative to the collapsed-extracted spectrum. The x and y offsets are then saved to the calibration
database for use throughout APERO.</p>
</section>
</section>
<section id="schematic">
<h2>2. Schematic<a class="headerlink" href="#schematic" title="Permalink to this heading">¶</a></h2>
<figure class="align-center" style="width: 100%">
<a class="reference internal image-reference" href="../../../_images/apero_shape_ref_spirou_schematic.jpg"><img alt="../../../_images/apero_shape_ref_spirou_schematic.jpg" src="../../../_images/apero_shape_ref_spirou_schematic.jpg" style="width: 100%;" /></a>
</figure>
</section>
<section id="usage">
<h2>3. Usage<a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apero_shape_ref_spirou</span><span class="o">.</span><span class="n">py</span> <span class="p">{</span><span class="n">obs_dir</span><span class="p">}[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">--</span><span class="n">fpfiles</span><span class="p">[</span><span class="n">FILE</span><span class="p">:</span><span class="n">FP_FP</span><span class="p">]</span> <span class="o">--</span><span class="n">hcfiles</span><span class="p">[</span><span class="n">FILE</span><span class="p">:</span><span class="n">HCONE_HCONE</span><span class="p">]</span> <span class="p">{</span><span class="n">options</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">obs_dir</span><span class="p">}[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="n">OBS_DIR_HELP</span>
<span class="o">--</span><span class="n">fpfiles</span><span class="p">[</span><span class="n">FILE</span><span class="p">:</span><span class="n">FP_FP</span><span class="p">]</span> <span class="o">//</span> <span class="n">SHAPE_FPFILES_HELP</span>
<span class="o">--</span><span class="n">hcfiles</span><span class="p">[</span><span class="n">FILE</span><span class="p">:</span><span class="n">HCONE_HCONE</span><span class="p">]</span> <span class="o">//</span> <span class="n">SHAPE_HCFILES_HELP</span>
</pre></div>
</div>
</section>
<section id="optional-arguments">
<h2>4. Optional Arguments<a class="headerlink" href="#optional-arguments" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">database</span><span class="p">[</span><span class="kc">True</span><span class="o">/</span><span class="kc">False</span><span class="p">]</span> <span class="o">//</span> <span class="p">[</span><span class="n">BOOLEAN</span><span class="p">]</span> <span class="n">Whether</span> <span class="n">to</span> <span class="n">add</span> <span class="n">outputs</span> <span class="n">to</span> <span class="n">calibration</span> <span class="n">database</span>
<span class="o">--</span><span class="n">badpixfile</span><span class="p">[</span><span class="n">FILE</span><span class="p">:</span><span class="n">BADPIX</span><span class="p">]</span> <span class="o">//</span> <span class="n">BADFILE_HELP</span>
<span class="o">--</span><span class="n">badcorr</span><span class="p">[</span><span class="kc">True</span><span class="o">/</span><span class="kc">False</span><span class="p">]</span> <span class="o">//</span> <span class="n">DOBAD_HELP</span>
<span class="o">--</span><span class="n">backsub</span><span class="p">[</span><span class="kc">True</span><span class="o">/</span><span class="kc">False</span><span class="p">]</span> <span class="o">//</span> <span class="n">BACKSUB_HELP</span>
<span class="o">--</span><span class="n">combine</span><span class="p">[</span><span class="kc">True</span><span class="o">/</span><span class="kc">False</span><span class="p">]</span> <span class="o">//</span> <span class="n">COMBINE_HELP</span>
<span class="o">--</span><span class="n">darkfile</span><span class="p">[</span><span class="n">FILE</span><span class="p">:</span><span class="n">DARKREF</span><span class="p">]</span> <span class="o">//</span> <span class="n">DARKFILE_HELP</span>
<span class="o">--</span><span class="n">darkcorr</span><span class="p">[</span><span class="kc">True</span><span class="o">/</span><span class="kc">False</span><span class="p">]</span> <span class="o">//</span> <span class="n">DODARK_HELP</span>
<span class="o">--</span><span class="n">flipimage</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">both</span><span class="p">]</span> <span class="o">//</span> <span class="n">FLIPIMAGE_HELP</span>
<span class="o">--</span><span class="n">fluxunits</span><span class="p">[</span><span class="n">ADU</span><span class="o">/</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="o">-</span><span class="p">]</span> <span class="o">//</span> <span class="n">FLUXUNITS_HELP</span>
<span class="o">--</span><span class="n">locofile</span><span class="p">[</span><span class="n">FILE</span><span class="p">:</span><span class="n">LOC_LOCO</span><span class="p">]</span> <span class="o">//</span> <span class="n">LOCOFILE_HELP</span>
<span class="o">--</span><span class="n">plot</span><span class="p">[</span><span class="mi">0</span><span class="o">&gt;</span><span class="n">INT</span><span class="o">&gt;</span><span class="mi">4</span><span class="p">]</span> <span class="o">//</span> <span class="p">[</span><span class="n">INTEGER</span><span class="p">]</span> <span class="n">Plot</span> <span class="n">level</span><span class="o">.</span> <span class="mi">0</span> <span class="o">=</span> <span class="n">off</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=</span> <span class="n">interactively</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=</span> <span class="n">save</span> <span class="n">to</span> <span class="n">file</span>
<span class="o">--</span><span class="n">resize</span><span class="p">[</span><span class="kc">True</span><span class="o">/</span><span class="kc">False</span><span class="p">]</span> <span class="o">//</span> <span class="n">RESIZE_HELP</span>
<span class="o">--</span><span class="n">no_in_qc</span> <span class="o">//</span> <span class="n">Disable</span> <span class="n">checking</span> <span class="n">the</span> <span class="n">quality</span> <span class="n">control</span> <span class="n">of</span> <span class="nb">input</span> <span class="n">files</span>
<span class="o">--</span><span class="n">fpref</span><span class="p">[</span><span class="n">FILE</span><span class="p">:</span><span class="n">REF_FP</span><span class="p">]</span> <span class="o">//</span> <span class="n">FPREFFILE_HELP</span>
</pre></div>
</div>
</section>
<section id="special-arguments">
<h2>5. Special Arguments<a class="headerlink" href="#special-arguments" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">xhelp</span><span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="n">Extended</span> <span class="n">help</span> <span class="n">menu</span> <span class="p">(</span><span class="k">with</span> <span class="nb">all</span> <span class="n">advanced</span> <span class="n">arguments</span><span class="p">)</span>
<span class="o">--</span><span class="n">debug</span><span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="n">Activates</span> <span class="n">debug</span> <span class="n">mode</span> <span class="p">(</span><span class="n">Advanced</span> <span class="n">mode</span> <span class="p">[</span><span class="n">INTEGER</span><span class="p">]</span> <span class="n">value</span> <span class="n">must</span> <span class="n">be</span> <span class="n">an</span> <span class="n">integer</span> <span class="n">greater</span> <span class="n">than</span> <span class="mi">0</span><span class="p">,</span> <span class="n">setting</span> <span class="n">the</span> <span class="n">debug</span> <span class="n">level</span><span class="p">)</span>
<span class="o">--</span><span class="n">listing</span><span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="n">Lists</span> <span class="n">the</span> <span class="n">night</span> <span class="n">name</span> <span class="n">directories</span> <span class="ow">in</span> <span class="n">the</span> <span class="nb">input</span> <span class="n">directory</span> <span class="k">if</span> <span class="n">used</span> <span class="n">without</span> <span class="n">a</span> <span class="s1">&#39;directory&#39;</span> <span class="n">argument</span> <span class="ow">or</span> <span class="n">lists</span> <span class="n">the</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">given</span> <span class="s1">&#39;directory&#39;</span> <span class="p">(</span><span class="k">if</span> <span class="n">defined</span><span class="p">)</span><span class="o">.</span> <span class="n">Only</span> <span class="n">lists</span> <span class="n">up</span> <span class="n">to</span> <span class="mi">15</span> <span class="n">files</span><span class="o">/</span><span class="n">directories</span>
<span class="o">--</span><span class="n">listingall</span><span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="n">Lists</span> <span class="n">ALL</span> <span class="n">the</span> <span class="n">night</span> <span class="n">name</span> <span class="n">directories</span> <span class="ow">in</span> <span class="n">the</span> <span class="nb">input</span> <span class="n">directory</span> <span class="k">if</span> <span class="n">used</span> <span class="n">without</span> <span class="n">a</span> <span class="s1">&#39;directory&#39;</span> <span class="n">argument</span> <span class="ow">or</span> <span class="n">lists</span> <span class="n">the</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">given</span> <span class="s1">&#39;directory&#39;</span> <span class="p">(</span><span class="k">if</span> <span class="n">defined</span><span class="p">)</span>
<span class="o">--</span><span class="n">version</span><span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="n">Displays</span> <span class="n">the</span> <span class="n">current</span> <span class="n">version</span> <span class="n">of</span> <span class="n">this</span> <span class="n">recipe</span><span class="o">.</span>
<span class="o">--</span><span class="n">info</span><span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="n">Displays</span> <span class="n">the</span> <span class="n">short</span> <span class="n">version</span> <span class="n">of</span> <span class="n">the</span> <span class="n">help</span> <span class="n">menu</span>
<span class="o">--</span><span class="n">program</span><span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="n">The</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">program</span> <span class="n">to</span> <span class="n">display</span> <span class="ow">and</span> <span class="n">use</span> <span class="p">(</span><span class="n">mostly</span> <span class="k">for</span> <span class="n">logging</span> <span class="n">purpose</span><span class="p">)</span> <span class="n">log</span> <span class="n">becomes</span> <span class="n">date</span> <span class="o">|</span> <span class="p">{</span><span class="n">THIS</span> <span class="n">STRING</span><span class="p">}</span> <span class="o">|</span> <span class="n">Message</span>
<span class="o">--</span><span class="n">recipe_kind</span><span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="n">The</span> <span class="n">recipe</span> <span class="n">kind</span> <span class="k">for</span> <span class="n">this</span> <span class="n">recipe</span> <span class="n">run</span> <span class="p">(</span><span class="n">normally</span> <span class="n">only</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">apero_processing</span><span class="o">.</span><span class="n">py</span><span class="p">)</span>
<span class="o">--</span><span class="n">parallel</span><span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="p">[</span><span class="n">BOOL</span><span class="p">]</span> <span class="n">If</span> <span class="kc">True</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">parellel</span> <span class="o">-</span> <span class="n">disable</span> <span class="n">some</span> <span class="n">features</span> <span class="p">(</span><span class="n">normally</span> <span class="n">only</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">apero_processing</span><span class="o">.</span><span class="n">py</span><span class="p">)</span>
<span class="o">--</span><span class="n">shortname</span><span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="n">Set</span> <span class="n">a</span> <span class="n">shortname</span> <span class="k">for</span> <span class="n">a</span> <span class="n">recipe</span> <span class="n">to</span> <span class="n">distinguish</span> <span class="n">it</span> <span class="kn">from</span> <span class="nn">other</span> <span class="n">runs</span> <span class="o">-</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">mainly</span> <span class="k">for</span> <span class="n">use</span> <span class="k">with</span> <span class="n">apero</span> <span class="n">processing</span> <span class="n">but</span> <span class="n">will</span> <span class="n">appear</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">log</span> <span class="n">database</span>
<span class="o">--</span><span class="n">idebug</span><span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="p">[</span><span class="n">BOOLEAN</span><span class="p">]</span> <span class="n">If</span> <span class="kc">True</span> <span class="n">always</span> <span class="n">returns</span> <span class="n">to</span> <span class="n">ipython</span> <span class="p">(</span><span class="ow">or</span> <span class="n">python</span><span class="p">)</span> <span class="n">at</span> <span class="n">end</span> <span class="p">(</span><span class="n">via</span> <span class="n">ipdb</span> <span class="ow">or</span> <span class="n">pdb</span><span class="p">)</span>
<span class="o">--</span><span class="n">ref</span><span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="n">If</span> <span class="nb">set</span> <span class="n">then</span> <span class="n">recipe</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">reference</span> <span class="n">recipe</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">reference</span> <span class="n">recipes</span> <span class="n">write</span> <span class="n">to</span> <span class="n">calibration</span> <span class="n">database</span> <span class="k">as</span> <span class="n">reference</span> <span class="n">calibrations</span><span class="p">)</span>
<span class="o">--</span><span class="n">crunfile</span><span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="n">Set</span> <span class="n">a</span> <span class="n">run</span> <span class="n">file</span> <span class="n">to</span> <span class="n">override</span> <span class="n">default</span> <span class="n">arguments</span>
<span class="o">--</span><span class="n">quiet</span><span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="n">Run</span> <span class="n">recipe</span> <span class="n">without</span> <span class="n">start</span> <span class="n">up</span> <span class="n">text</span>
<span class="o">--</span><span class="n">nosave</span><span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="n">Do</span> <span class="ow">not</span> <span class="n">save</span> <span class="nb">any</span> <span class="n">outputs</span> <span class="p">(</span><span class="n">debug</span><span class="o">/</span><span class="n">information</span> <span class="n">run</span><span class="p">)</span><span class="o">.</span> <span class="n">Note</span> <span class="n">some</span> <span class="n">recipes</span> <span class="n">require</span> <span class="n">other</span> <span class="n">recipesto</span> <span class="n">be</span> <span class="n">run</span><span class="o">.</span> <span class="n">Only</span> <span class="n">use</span> <span class="o">--</span><span class="n">nosave</span> <span class="n">after</span> <span class="n">previous</span> <span class="n">recipe</span> <span class="n">runs</span> <span class="n">have</span> <span class="n">been</span> <span class="n">run</span> <span class="n">successfully</span> <span class="n">at</span> <span class="n">least</span> <span class="n">once</span><span class="o">.</span>
<span class="o">--</span><span class="n">force_indir</span><span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="n">Force</span> <span class="n">the</span> <span class="n">default</span> <span class="nb">input</span> <span class="n">directory</span> <span class="p">(</span><span class="n">Normally</span> <span class="nb">set</span> <span class="n">by</span> <span class="n">recipe</span><span class="p">)</span>
<span class="o">--</span><span class="n">force_outdir</span><span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="o">//</span> <span class="p">[</span><span class="n">STRING</span><span class="p">]</span> <span class="n">Force</span> <span class="n">the</span> <span class="n">default</span> <span class="n">output</span> <span class="n">directory</span> <span class="p">(</span><span class="n">Normally</span> <span class="nb">set</span> <span class="n">by</span> <span class="n">recipe</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="output-directory">
<h2>6. Output directory<a class="headerlink" href="#output-directory" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DRS_DATA_REDUC</span> <span class="o">//</span> <span class="n">Default</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span> <span class="n">directory</span>
</pre></div>
</div>
</section>
<section id="output-files">
<h2>7. Output files<a class="headerlink" href="#output-files" title="Permalink to this heading">¶</a></h2>
<table class="csvtable docutils align-default" id="id1">
<caption><span class="caption-text">Outputs</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>description</p></th>
<th class="head"><p>HDR[DRSOUTID]</p></th>
<th class="head"><p>file type</p></th>
<th class="head"><p>suffix</p></th>
<th class="head"><p>dbname</p></th>
<th class="head"><p>dbkey</p></th>
<th class="head"><p>input file</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>REF_FP</p></td>
<td><p>Reference shape master FP calibration file</p></td>
<td><p>REF_FP</p></td>
<td><p>.fits</p></td>
<td><p>_fpref</p></td>
<td><p>calibration</p></td>
<td><p>FPREF</p></td>
<td><p>FP_FP</p></td>
</tr>
<tr class="row-odd"><td><p>SHAPE_X</p></td>
<td><p>Reference shape dx calibration file</p></td>
<td><p>SHAPE_X</p></td>
<td><p>.fits</p></td>
<td><p>_shapex</p></td>
<td><p>calibration</p></td>
<td><p>SHAPEX</p></td>
<td><p>FP_FP</p></td>
</tr>
<tr class="row-even"><td><p>SHAPE_Y</p></td>
<td><p>Reference shape dy calibration file</p></td>
<td><p>SHAPE_Y</p></td>
<td><p>.fits</p></td>
<td><p>_shapey</p></td>
<td><p>calibration</p></td>
<td><p>SHAPEY</p></td>
<td><p>FP_FP</p></td>
</tr>
<tr class="row-odd"><td><p>SHAPE_IN_FP</p></td>
<td><p>Input FP file for shape comparison</p></td>
<td><p>SHAPE_IN_FP</p></td>
<td><p>.fits</p></td>
<td><p>_shape_in_fp</p></td>
<td><p>–</p></td>
<td><p>–</p></td>
<td><p>FP_FP</p></td>
</tr>
<tr class="row-even"><td><p>SHAPE_IN_HC</p></td>
<td><p>Input Hollow Cathode file forshape comparison</p></td>
<td><p>SHAPE_IN_HC</p></td>
<td><p>.fits</p></td>
<td><p>_shape_in_hc</p></td>
<td><p>–</p></td>
<td><p>–</p></td>
<td><p>HCONE_HCONE</p></td>
</tr>
<tr class="row-odd"><td><p>SHAPE_OUT_FP</p></td>
<td><p>Output FP file for shape comparison</p></td>
<td><p>SHAPE_OUT_FP</p></td>
<td><p>.fits</p></td>
<td><p>_shape_out_fp</p></td>
<td><p>–</p></td>
<td><p>–</p></td>
<td><p>FP_FP</p></td>
</tr>
<tr class="row-even"><td><p>SHAPE_OUT_HC</p></td>
<td><p>Output Hollow Cathode file forshape comparison</p></td>
<td><p>SHAPE_OUT_HC</p></td>
<td><p>.fits</p></td>
<td><p>_shape_out_hc</p></td>
<td><p>–</p></td>
<td><p>–</p></td>
<td><p>HCONE_HCONE</p></td>
</tr>
<tr class="row-odd"><td><p>SHAPE_BDX</p></td>
<td><p>Shape transformed dx comparison file</p></td>
<td><p>SHAPE_BDX</p></td>
<td><p>.fits</p></td>
<td><p>_shape_out_bdx</p></td>
<td><p>–</p></td>
<td><p>–</p></td>
<td><p>FP_FP</p></td>
</tr>
<tr class="row-even"><td><p>DEBUG_BACK</p></td>
<td><p>Individual file background map</p></td>
<td><p>DEBUG_BACK</p></td>
<td><p>.fits</p></td>
<td><p>_background.fits</p></td>
<td><p>–</p></td>
<td><p>–</p></td>
<td><p>DRS_PP</p></td>
</tr>
</tbody>
</table>
</section>
<section id="debug-plots">
<h2>8. Debug plots<a class="headerlink" href="#debug-plots" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SHAPE_DX</span>
<span class="n">SHAPE_ANGLE_OFFSET_ALL</span>
<span class="n">SHAPE_ANGLE_OFFSET</span>
<span class="n">SHAPE_LINEAR_TPARAMS</span>
</pre></div>
</div>
</section>
<section id="summary-plots">
<h2>9. Summary plots<a class="headerlink" href="#summary-plots" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SUM_SHAPE_ANGLE_OFFSET</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="rdefinition_SHAPE.html" title="apero_shape_spirou"
             >next</a> |</li>
        <li class="right" >
          <a href="rdefinition_LOC.html" title="apero_loc_spirou"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">APERO 0.8.001 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../main/spirou/main_spirou.html" >SPIRou documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="recipes.html" >Recipes (SPIROU)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">apero_shape_ref_spirou</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Neil Cook.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.0.1.
    </div>
  </body>
</html>