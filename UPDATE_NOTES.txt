# Update Note Summary - Version 0.6.130

Date: 2020-08-27

## Updates since Version 0.6.129

- cal_preprocessing
    - all OBJECTs now upper case

- cal_extract
    - added a quick look which only produces new files
        {odocode}_pp_e2ds_AB.fits --> {odocode}_pp_q2ds_AB.fits
        {odocode}_pp_e2dsff_AB.fits --> {odocode}_pp_q2dsff_AB.fits
    - normal cal_extract:
        - 291.809 s
    - cal_extract --quicklook=True:
        - 118.873 s
    - cal_extract --quicklook=True --fiber=AB:
        - 58.165 s

- cal_shape_master
    - correct ALLOWED_FP_TYPES (didn't break but would on change of input)

- cal_wave_master
    - added header keys to wave res map (NBO, NREGIONS)
    - updated gaussian param header valeus with names

- obj_mk_template
    - copied arrays to close fits files (to stop many fits being open at same
      time while creating template)

- obj_mk_tellu / obj_fit_tellu
    - apply bounds to magic grid for pre-cleaning abso_expo vector
    - when saving pre-clean only mask to exp(-2) not exp(-1)
    - filter trans files by expo H2O and expo OTHERS and use 50 closest to
      fit pca

- Tools
    - update spirou/nirps tool names to follow conventions
    - add first attempt at cal_drift from wave sol CCF
        - located in apero-drs/tools/spirou
    - processing now skips based on log.fits recipe calls (i.e. will skip
      identical recipe calls)

- General
    - now have an assets directory (on install/reset apero.data moved here for
      local storage/modification) - eventually will get this from e.g. wget


## Still to do:
    - polar code update
    - Implement database instead of text/fits files for databases
        - index.fits, log.fits, object database, calibDB, telluDB
    - Blacklist odometer codes
    - Move data to user files + download / host not from github
    - move all fits-images to start in extension 1 (not 0)
    - add option to set template for mk_tellu and fit_tellu from args
    - create script to get custom config (larger list of constants)
    - add plot modes 3 and 4
        - `plot== 3` (all debug plots shown) and `plot==4` (all debug plots saved) modes
    - make code to check constants/keywords usage (function usage)
    - separate warning messages into codes 10-000-00000 and 20-000-00000
        - codes 20-000-00000 for trigger to catch
    - go through all summary plots and decide which plots, write figure captions, improve plots, write quality control description, decide which header keys to print
    - add all functions doc strings + display func for all functions
    - make classes picklable and then switch from multiprocessing.pool to spawn
    - NIRPS implementation of cal_wave onwards
    - EA masks from templates

## To do later:
    - implement persistence correction
    - CCF wrapper using weighting/sanitise/bisector etc?
    - propagate uncertainies / flags for NaNs
    - proper SNR calculation
    - integrate CFHT outputs input drs
    - write documentation
    - write paper

## Known issues:
    - Locking of files means using >5 cores slows down a lot (fix with database)
        - if locking is big problem use only 1 core
    - Weird residuals left in order_profile after dark_flat (loc)
    - Calibrations switch over at different points from PM to AM calibrations
        - should really only use "older"
    - NIRPS breaks in shape
