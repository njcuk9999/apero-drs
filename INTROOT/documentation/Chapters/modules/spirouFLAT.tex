
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
\clearpage
\newpage
\noindent\begin{minipage}{\textwidth}
\section{The spirouFLAT module}
\label{ch:the_module:spirouFLAT}
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
\subsection{MeasureBlazeForOrder}

Defined in \spirouFLAT\path{.spirouFLAT.measure_blaze_for_order}

\begin{pythonbox}
from SpirouDRS import spirouFLAT
spirouFLAT.MeasureBlazeForOrder(p, y)
spirouFLAT.spirouFLAT.measure_blaze_for_order(p, y)
\end{pythonbox}

\begin{pythondocstring}
Measure the blaze function (for good pixels this is a polynomial fit of
order = fitdegree, for bad pixels = 1.0).

bad pixels are defined as less than or equal to zero

:param y: numpy array (1D), the extracted pixels for this order
:param fitdegree: int, the polynomial degree

:return blaze: numpy array (1D), size = len(y), the blaze function: for
               good pixels this is the value of the fit, for bad pixels the
               value = 1.0
\end{pythondocstring}
\end{minipage}


%----------------------------------------------------------------------------------------

\noindent\begin{minipage}{\textwidth}
\subsection{GetFlat}

Defined in \spirouFLAT\path{.spirouFLAT.get_flat}

\begin{pythonbox}
from SpirouDRS import spirouFLAT
spirouFLAT.GetFlat(p=None, loc=None, hdr=None, filename=None)
spirouFLAT.spirouFLAT.get_flat(p=None, loc=None, hdr=None, filename=None)
\end{pythonbox}

\begin{pythondocstring}
    Attempts to read the flat and if it fails uses a constant flat

    :param p or None: parameter dictionary, ParamDict containing constants
        If defined must contain at least:
            fitsfilename: string, the full path of for the main raw fits
                          file for a recipe
                          i.e. /data/raw/20170710/filename.fits
            fiber: string, the fiber used for this recipe (eg. AB or A or C)
            log_opt: string, log option, normally the program name
    :param loc: parameter dictionary, ParamDict containing data
        Must contain at least:
            data: numpy array (2D), the image (used for shape)
    :param hdr or None: dictionary or None, if defined is the header file used
                        to choose the date used in teh calibDB (else uses
                        FITSFILENAME to get date for calibDB)
    :param filename or None: string, the flat file name to read, if None
                             uses FLAT_{FIBER} and gets the flat filename from
                             calibDB

    :return lloc: parameter dictionary, the updated parameter dictionary
            Adds/updates the following:
                FLAT: numpy array (2D), the flat image should be the same
                      shape as data
\end{pythondocstring}
\end{minipage}


%----------------------------------------------------------------------------------------

\noindent\begin{minipage}{\textwidth}
\subsection{GetValidOrders}

Defined in \spirouFLAT\path{.spirouFLAT.get_valid_orders}
\begin{pythonbox}
from SpirouDRS import spirouFLAT
spirouFLAT.GetValidOrders(p, loc)
spirouFLAT.spirouFLAT.get_valid_orders(p, loc)
\end{pythonbox}

\begin{pythondocstring}
Get valid order range (from min to max) from constants

:param p: parameter dictionary, ParamDict containing constants
    Must contain at least:
        FF_START_ORDER: int or None, the order number to start with, if
                         None this is set to zero
        FF_END_ORDER: int or None, the order number to end with, if None
                       this is set to the last order number
:param loc: parameter dictionary, ParamDict containing data
        Must contain at least:
            number_orders: int, the number of orders in reference spectrum
:return valid_ordesr: list, all integer values between the start order and
                      end order
\end{pythondocstring}
\end{minipage}

%----------------------------------------------------------------------------------------
